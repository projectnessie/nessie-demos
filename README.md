# Nessie Demos

[![Main CI](https://github.com/projectnessie/nessie-demos/actions/workflows/main.yml/badge.svg)](https://github.com/projectnessie/nessie-demos/actions/workflows/main.yml)

The purpose of this repo is to provide a set of Jupyter notebooks (which are all unit tested) that show how Nessie can be used with other projects, such as Iceberg/Spark/Flink/Deltalake.
Below is a list of working Jupyter notebooks, which can be run either on [Google Colab](https://colab.research.google.com/) or on [Binder](https://mybinder.org/):

* Nessie-Iceberg-NBA Jupyter Notebook
    * [Google Colaboratory URL](https://colab.research.google.com/github/projectnessie/nessie-demos/blob/main/colab/nessie-iceberg-demo-nba.ipynb)
    * [Binder (mybinder.org)](https://mybinder.org/v2/gh/projectnessie/nessie-demos/main?filepath=colab%2Fnessie-iceberg-demo-nba.ipynb)
* How to setup Pyspark/Spark + Iceberg for Nessie
    * [Google Colaboratory URL](https://colab.research.google.com/github/projectnessie/nessie-demos/blob/main/colab/nessie-iceberg-spark-setup.ipynb)
    * [Binder (mybinder.org)](https://mybinder.org/v2/gh/projectnessie/nessie-demos/main?filepath=colab%2Fnessie-iceberg-spark-setup.ipynb)

Upcoming Jupyter notebooks are shown below:

* Notebooks for Nessie w/ Flink+Iceberg
* Notebooks for Nessie w/ Deltalake

## Directory structure

| directory | purpose |
| --------- | ------- |
| `colab/` | Contains unit-testable Jupyter notebooks that can run in Google Colaboratory and Binder.
| `notebook-tests/` | Contains unit tests  for all Jupyter notebooks from the `colab` directory.
| `pydemolib/` | Python library that helps to eliminate nearly all boilerplate code in Jupyter notebook based demos. This is not meant to be used in production. See also the disclaimer [here](pydemolib/README.rst).
| `configs/` | Configuration files that define Nessie, Iceberg, Spark versions and dependencies, supporting demos using different product versions.
| `datasets/` | Various datasets that can be used by the demos. The nessiedemo Python library in `pydemolib/` supports downloading and accessing these datasets.
| `/` | Also contains `apt.txt` + `requirements.txt` used by Binder. This `requirements.txt` has nothing to do with the `requirements.txt` in `pydemolib/`.

## How to add a new Jupyter Notebook Demo?

A new demo will generally require changes in the following places:
* adding a new notebook under `colab`
* adding a new config file with the required demo dependencies under `configs`. This new config file is then referenced in `setup_demo("my_new_config.yml", ["nba"])`
* if the new demo uses a new dataset, then this dataset needs to be added to `datasets` and properly referenced in the notebook: `setup_demo("my_new_config.yml", ["my_new_dataset"])`
* a new unit test under `notebook-tests/tests`
* if the new demo requires some dependency setup code that isn't already covered in `pydemolib/nessiedemo`, it will then require a new module under `pydemolib/nessiedemo` with additional tests under `pydemolib/tests`
The entire demo setup code for the new notebook would then look as shown below:

```python
from nessiedemo.demo import setup_demo
demo = setup_demo("my_new_config.yml", ["my_new_dataset"])

# Downloads and sets up X
from nessiedemo.new_module_x import x_for_demo
x = x_for_demo(demo)
```

## Jupyter notebook environments

### Google Colaboratory

[Google Colaboratory](https://colab.research.google.com/) provides a Jupyter environment.
Users basically just provide a URL to a `.ipynb` file, which is then loaded. The runtime
environment is a container/image that is pre-defined by Google. Changing the base operating
system and such is not possible. Bumping the pre-installed Python dependencies is not feasible.

### Binder

[Binder](https://mybinder.org) is a more customizable platform for Jupyter notebooks and
more (see their website). Binder generates a Dockerfile + image based on the settings in the
source GitHub repository (other sources are possible). It is possible to pre-install both
e.g. Ubuntu and/or Python packages into the Docker image generated by Binder.

Of course, Binder just lets a user "simply start" a notebook via a simple "click on a link".

## Git history

The history in Git should work the same way as for [Project Nessie repo](https://github.com/projectnessie/nessie/),
i.e. a linear git history (no merges, no branches, PR-squash-and-merge).

## Compatibility Matrix

| Nessie | Apache Iceberg | Apache Spark | Notes
| ------ | -------------- | ------------ | -----
| 0.5.1  | 0.11.1         | 3.0          | Iceberg declares Nessie 0.3.0, but there are no _breaking_ (REST)API changes between Nessie 0.4.0 and 0.5.1
